<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Object Manager</title>
</head>
<body>
  <h1>Object Manager</h1>

  <form id="objectForm">
    <input type="text" id="name" placeholder="Name" required />
    <input type="number" id="price" placeholder="Price" required />
    <input type="number" id="quantity" placeholder="Quantity" required />
    <button type="submit">Add Object</button>
  </form>

  <table border="1">
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="objectTable"></tbody>
  </table>

  <script>
   const API_URL = "https://object-manager.onrender.com/api/objects"; 

// Fetch all objects
async function fetchObjects() {
  const res = await fetch(API_URL);
  const data = await res.json();

  const tableBody = document.querySelector("#objectTable tbody");
  tableBody.innerHTML = "";

  data.forEach(obj => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td contenteditable="true" data-id="${obj._id}" data-field="name">${obj.name}</td>
      <td contenteditable="true" data-id="${obj._id}" data-field="price">${obj.price}</td>
      <td contenteditable="true" data-id="${obj._id}" data-field="quantity">${obj.quantity}</td>
      <td><button onclick="deleteObject('${obj._id}')">Delete</button></td>
    `;

    // Save changes when cell loses focus
    row.querySelectorAll("[contenteditable]").forEach(cell => {
      cell.addEventListener("blur", saveIfChanged);
    });

    tableBody.appendChild(row);
  });
}

// Save edited cell value
async function saveIfChanged(event) {
  const cell = event.target;
  const id = cell.dataset.id;
  const field = cell.dataset.field;
  const newValue = cell.innerText;

  try {
    const res = await fetch(`${API_URL}/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ [field]: newValue })
    });

    if (!res.ok) throw new Error("PUT failed: " + res.status);
    console.log("Updated:", field, "=", newValue);
  } catch (err) {
    console.error(err);
  }
}

// Delete object
async function deleteObject(id) {
  try {
    const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });

    if (!res.ok) throw new Error("DELETE failed: " + res.status);
    console.log("Deleted:", id);

    fetchObjects(); // Refresh list
  } catch (err) {
    console.error(err);
  }
}

// Add new object
document.getElementById("objectForm").addEventListener("submit", async e => {
  e.preventDefault();
  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;
  const quantity = document.getElementById("quantity").value;

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, price, quantity })
    });

    if (!res.ok) throw new Error("POST failed: " + res.status);

    document.getElementById("objectForm").reset();
    fetchObjects(); // Refresh
  } catch (err) {
    console.error(err);
  }
});

// Initial fetch
fetchObjects();

  </script>
</body>
</html>

