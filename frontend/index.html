<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Object Manager</title>
</head>
<body>
  <h1>Object Manager</h1>

  <form id="objectForm">
    <input type="text" id="name" placeholder="Name" required />
    <input type="number" id="price" placeholder="Price" required />
    <input type="number" id="quantity" placeholder="Quantity" required />
    <button type="submit">Add Object</button>
  </form>

  <table border="1">
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="objectTable"></tbody>
  </table>

  <script>
    const API_URL = "https://object-manager.onrender.com/api/objects";

    async function fetchObjects() {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderTable(data);
    }

    function renderTable(objects) {
      const table = document.getElementById("objectTable");
      table.innerHTML = "";

      objects.forEach(obj => {
        const row = document.createElement("tr");

        // Editable name
        const nameCell = document.createElement("td");
        nameCell.contentEditable = true;
        nameCell.innerText = obj.name;
        row.appendChild(nameCell);

        // Editable price
        const priceCell = document.createElement("td");
        priceCell.contentEditable = true;
        priceCell.innerText = obj.price;
        row.appendChild(priceCell);

        // Editable quantity
        const qtyCell = document.createElement("td");
        qtyCell.contentEditable = true;
        qtyCell.innerText = obj.quantity;
        row.appendChild(qtyCell);

        // Total = price * qty
        const totalCell = document.createElement("td");
        totalCell.innerText = obj.price * obj.quantity;
        row.appendChild(totalCell);

        // Actions
        const actionsCell = document.createElement("td");

        // Save button
        const saveBtn = document.createElement("button");
        saveBtn.innerText = "Save";
        saveBtn.onclick = async () => {
          await updateObject(obj._id, {
            name: nameCell.innerText,
            price: Number(priceCell.innerText),
            quantity: Number(qtyCell.innerText)
          });
        };
        actionsCell.appendChild(saveBtn);

        // Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.innerText = "Delete";
        deleteBtn.onclick = async () => {
          await deleteObject(obj._id);
        };
        actionsCell.appendChild(deleteBtn);

        row.appendChild(actionsCell);

        table.appendChild(row);
      });
    }

    async function addObject(newObj) {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newObj)
      });
      await fetchObjects();
    }

    async function updateObject(id, updatedObj) {
      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedObj)
        });
        if (!res.ok) throw new Error(`PUT failed: ${res.status}`);
        await fetchObjects();
      } catch (err) {
        console.error(err);
      }
    }

    async function deleteObject(id) {
      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "DELETE"
        });
        if (!res.ok) throw new Error(`DELETE failed: ${res.status}`);
        await fetchObjects();
      } catch (err) {
        console.error(err);
      }
    }

    // Handle form submit
    document.getElementById("objectForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const price = Number(document.getElementById("price").value);
      const quantity = Number(document.getElementById("quantity").value);

      await addObject({ name, price, quantity });

      e.target.reset();
    });

    // Load data on page load
    fetchObjects();
  </script>
</body>
</html>
